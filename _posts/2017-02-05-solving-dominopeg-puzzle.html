---
layout: post
title: Solving the DominoPeg Puzzle
date: '2017-02-05T19:45:00.001-06:00'
author: Patrick Blesi
comments: true
tags:
- Depth-First Search
- Artificial Intelligence
- DominoPeg Puzzle
- Puzzles
- Ruby
modified_time: '2017-02-05T19:55:48.375-06:00'
thumbnail: https://4.bp.blogspot.com/-tEVDp91BoNw/WIAyWIzyvAI/AAAAAAAAIpM/T2uV-iUrYuUV5DFacY-PCKDxiO80YRvWQCLcB/s72-c/dominopeg.jpg
blogger_id: tag:blogger.com,1999:blog-828748641237114041.post-3517654527399876161
blogger_orig_url: http://patrick.ble.si/2017/02/solving-dominopeg-puzzle.html
---

Recently, frustrated with my inability to solve a wooden puzzle at my in-laws, I realized a computer is much better suited to solve a wooden puzzle than I am. So I decided to put the years I spent studying computer science to use, writing a solver for this puzzle using a depth-first search algorithm. Meanwhile, while the computer works for me, I can sit in the sun and sip lemonade!<br /><br /><h3><br />The DominoPeg Puzzle&nbsp;</h3><div><br /></div>The&nbsp;<a href="http://www.puzzlemist.com/dominopeg.html" target="_blank">DominoPeg puzzle</a>&nbsp;is a 12-piece wooden puzzle where each piece is surrounded by circles or absences of circles. There are six of these spots on each piece, one on each corner and one on each of the long sides. Pieces can be placed in the puzzle vertically or horizontally; they can be flipped over as well to fit into the puzzle. When all pieces are fit into the puzzle, five holes will be present.<br /><br />It is difficult to fit all the pieces into the puzzle, and it is even more difficult to find a solution to the puzzle given a specific arrangement of these five holes. This is what prompted me to write a solver.<br /><br /><br /><div class="separator" style="clear: both; text-align: center;"></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-tEVDp91BoNw/WIAyWIzyvAI/AAAAAAAAIpM/T2uV-iUrYuUV5DFacY-PCKDxiO80YRvWQCLcB/s1600/dominopeg.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="325" src="https://4.bp.blogspot.com/-tEVDp91BoNw/WIAyWIzyvAI/AAAAAAAAIpM/T2uV-iUrYuUV5DFacY-PCKDxiO80YRvWQCLcB/s400/dominopeg.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8px;"><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td class="tr-caption" style="font-size: 12.8px;">A wooden dominopeg puzzle with holes arranged in a diagonal pattern</td></tr></tbody></table></td></tr></tbody></table><h3></h3><h4></h4><h4></h4><h4></h4><h4><br /></h4><h4><br /></h4><h4>The Solver</h4><div><i>The entire solution can be found&nbsp;<a href="https://gist.github.com/pblesi/04eae033d76132d4de6f98ec9581c1f8" target="_blank">here</a>.</i></div><div><br /></div><div>I wrote the solver in Ruby for the same reason that I write so many of my solutions in Ruby: because it's fun! The solution is 249 lines long. It consists of a Piece class, a Board class, and a Solver module. We'll set up a domain to represent our puzzle and then employ a depth-first search algorithm to find a solution to the puzzle.&nbsp;</div><h4></h4><h3></h3><h3></h3><h3></h3><h3><br /></h3><h3>Setting the Problem Domain</h3><br />We represent the puzzle board by setting up a grid. The puzzle actually contains two grids, one that represents the placement of the pieces, and one that represents the locations of the circles, leaving 5 circles empty when all puzzle pieces are placed in the puzzle. The board's piece dimensions are 6 x 4 and its circle dimensions are 7 x 5. Each puzzle piece has piece dimensions of 2 x 1 and circle dimensions of 3 x 2. When placing a puzzle piece on the board we keep track of both the piece positions that the puzzle piece takes up and the circle positions that the puzzle piece takes up.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-DMlUZuGMdr0/WIBLDyEF62I/AAAAAAAAIpc/IIcTGLR0_Dkb-wKD5hKxAGy6ArLR3XLIQCLcB/s1600/dominopeg-circle-grid.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="325" src="https://1.bp.blogspot.com/-DMlUZuGMdr0/WIBLDyEF62I/AAAAAAAAIpc/IIcTGLR0_Dkb-wKD5hKxAGy6ArLR3XLIQCLcB/s400/dominopeg-circle-grid.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8px;">The board is represented by a circle grid where each circle is represented by index 0 through 34</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-Ys1kqPpF4BE/WIBLDyBLnXI/AAAAAAAAIpg/DvgyY1AmPtUhQgFuob20s735qA6BdRsbACLcB/s1600/dominopeg-piece-grid.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="325" src="https://4.bp.blogspot.com/-Ys1kqPpF4BE/WIBLDyBLnXI/AAAAAAAAIpg/DvgyY1AmPtUhQgFuob20s735qA6BdRsbACLcB/s400/dominopeg-piece-grid.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8px;"><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td class="tr-caption" style="font-size: 12.8px;">The board is also represented by a piece grid where each piece location is represented by index 0 through 23</td></tr></tbody></table></td></tr></tbody></table><span style="font-weight: normal;"><br>When the board is organized in this way, placing a piece on the board is a matter of marking what spots the piece takes up, and continuing to place pieces on the board until we find a solution.&nbsp;</span><br /><span style="font-weight: normal;"><br /></span><div>We represent puzzle pieces based on the circles that they cover. We have canonical representations of each of the 12 puzzle pieces. In addition to these 12 canonical representations, we represent flipped puzzle pieces and rotated puzzle pieces as separate puzzle pieces that are variations of the same canonical puzzle piece. These transformations of puzzle pieces lead to 70 distinct puzzle pieces when orientation is taken into account. The reason there are 70 distinct pieces and not 96 (12 pieces X 4 rotations X 2 flips) is because some of the pieces contain symmetry and are duplicates of each other.</div><div><br /></div><div><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: consolas, &quot;liberation mono&quot;, menlo, courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; overflow: auto; padding: 16px; word-break: normal; word-wrap: normal;"><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">def</span> <span class="pl-en" style="box-sizing: border-box; color: #795da3;">_init_pieces</span><br />  pieces <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> []<br />  <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">BasePieces</span>.each <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">do </span>|<span class="pl-smi" style="box-sizing: border-box;">base_piece</span>|<br />    <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">Flips</span>.each <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">do </span>|<span class="pl-smi" style="box-sizing: border-box;">flip</span>|<br />      <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">Orientations</span>.each <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">do </span>|<span class="pl-smi" style="box-sizing: border-box;">orientation</span>|<br />        pieces <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">&lt;&lt;</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">Piece</span>.<span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">new</span>(base_piece, flip, orientation)<br />      <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br />  pieces.uniq { |<span class="pl-smi" style="box-sizing: border-box;">piece</span>| [piece.transpose, piece.horizontal?] }<br /><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span></pre></div><br /><div><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: consolas, &quot;liberation mono&quot;, menlo, courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; overflow: auto; padding: 16px; word-break: normal; word-wrap: normal;"><span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">BasePieces</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> [<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>0<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>1<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>2<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>3<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>4<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>5<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>6<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>7<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>8<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>9<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>A<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>]},<br />  {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">id:</span> <span class="pl-s" style="box-sizing: border-box; color: #183691;"><span class="pl-pds" style="box-sizing: border-box;">"</span>B<span class="pl-pds" style="box-sizing: border-box;">"</span></span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">spots:</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>]},<br />]<br /><br /><span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">Flips</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">false</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">true</span>]<br /><br /><span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">Orientations</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">90</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">180</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">270</span>]</pre></div><div><br /></div><div>Flips represent whether the piece is a flipped version of one of the canonical representations. Orientation represents whether the canonical pieces is rotated and by how many degrees it is rotated (0 representing no rotation of the canonical piece). A base piece's spots represent the circles that would be covered on the board if the piece were to be placed in the top left of the board.&nbsp;</div><div><br /></div><div>In order to represent each piece we take the canonical representation and apply transformations to the piece positions and circles that it covers.&nbsp;</div><h4><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: consolas, &quot;liberation mono&quot;, menlo, courier, monospace; font-size: 13.6px; font-stretch: normal; font-weight: normal; line-height: 1.45; overflow: auto; padding: 16px; word-break: normal; word-wrap: normal;"><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">def</span> <span class="pl-en" style="box-sizing: border-box; color: #795da3;">piece_positions</span><br />  horizontal? <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">?</span> [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>] : [<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">6</span>]<br /><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br /><br /><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">def</span> <span class="pl-en" style="box-sizing: border-box; color: #795da3;">transpose</span><br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">return</span> <span class="pl-smi" style="box-sizing: border-box;">@transpose</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">if</span> <span class="pl-smi" style="box-sizing: border-box;">@transpose</span><br />  spots <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> base_piece[<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">:spots</span>]<br />  spots <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> spots.map { |<span class="pl-smi" style="box-sizing: border-box;">spot</span>| <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">FlipMap</span>[spot] } <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">if</span> flip<br />  <span class="pl-smi" style="box-sizing: border-box;">@transpose</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> spots.map { |<span class="pl-smi" style="box-sizing: border-box;">spot</span>| <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">OrientationMaps</span>[orientation][spot] }.sort<br /><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span></pre></h4><h4><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: consolas, &quot;liberation mono&quot;, menlo, courier, monospace; font-size: 13.6px; font-stretch: normal; font-weight: normal; line-height: 1.45; overflow: auto; padding: 16px; word-break: normal; word-wrap: normal;"><span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">FlipMap</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>}<br /><br /><span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">OrientationMaps</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> {<br />  <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span> =&gt; {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>},<br />  <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">90</span> =&gt; {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">15</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">14</span>},<br />  <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">180</span> =&gt; {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>},<br />  <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">270</span> =&gt; {<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">14</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">2</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">15</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">8</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">9</span>=&gt;<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">1</span>},<br />}</pre></h4><h4></h4><h3></h3><h3></h3><h3><br /></h3><h3>Solving Using Depth-First Search</h3><br />The solver is a recursive algorithm employing depth-first search. For each of the puzzle pieces it has, it places the piece in the puzzle, and then tries to solve a new puzzle with the new set of puzzle pieces (the placed puzzle piece and canonical equivalent pieces are removed) and the new board (because the new board has additional constraints added to it by the piece that was just laid).<br /><br />If there are no more puzzle pieces left then we know that we have placed all the puzzle pieces on the board and have found a solution. If we go through all our pieces and none of them can be placed on the board, then we know we've hit a dead end and this board cannot be solved with this set of puzzle pieces.<br /><br /><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: consolas, &quot;liberation mono&quot;, menlo, courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; overflow: auto; padding: 16px; word-break: normal; word-wrap: normal;"><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">module</span> <span class="pl-en" style="box-sizing: border-box; color: #795da3;">Solver</span><br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">def</span> <span class="pl-en" style="box-sizing: border-box; color: #795da3;">self.solve</span>(<span class="pl-smi" style="box-sizing: border-box;">board</span>, <span class="pl-smi" style="box-sizing: border-box;">pieces</span>)<br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">if</span> pieces.any?<br />      pieces.each <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">do </span>|<span class="pl-smi" style="box-sizing: border-box;">piece</span>|<br />        <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">if</span> board.accepts?(piece)<br />          new_pieces <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> remove(pieces, piece)<br />          new_board <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">Board</span>.from_existing_board(board)<br />          new_board.apply(piece)<br />          solution <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> solve(new_board, new_pieces)<br />          <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">return</span> solution <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">if</span> solution<br />        <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br />      <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">else</span><br />      <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">return</span> board<br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br />    <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">nil</span><br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br /><br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">def</span> <span class="pl-en" style="box-sizing: border-box; color: #795da3;">self.remove</span>(<span class="pl-smi" style="box-sizing: border-box;">pieces</span>, <span class="pl-smi" style="box-sizing: border-box;">piece_to_remove</span>)<br />    pieces.reject <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">do </span>|<span class="pl-smi" style="box-sizing: border-box;">piece</span>|<br />      piece.base_piece[<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">:id</span>] <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">==</span> piece_to_remove.base_piece[<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">:id</span>]<br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br /><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span></pre><br />When determining if a board accepts a piece, we only need to look at the top left most uncovered piece position. If we cannot fit any of our pieces into that position, then the current board configuration is invalid and there is no need to try to further fit pieces into this configuration.<br /><br /><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: consolas, &quot;liberation mono&quot;, menlo, courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; overflow: auto; padding: 16px; word-break: normal; word-wrap: normal;"><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">def</span> <span class="pl-en" style="box-sizing: border-box; color: #795da3;">accepts?</span>(<span class="pl-smi" style="box-sizing: border-box;">piece</span>)<br />  first_piece_spot <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> _first_empty_piece_spot<br />  piece_positions <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> _piece_positions(first_piece_spot, piece)<br /><br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">if</span> piece_positions[<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>] <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">%</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">PIECE_WIDTH</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">+</span> piece.piece_width <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">&gt;</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">PIECE_WIDTH</span><br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">return</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">false</span><br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br /><br />  piece_positions.each <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">do </span>|<span class="pl-smi" style="box-sizing: border-box;">piece_position</span>|<br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">return</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">false</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">if</span> piece_position <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">&gt;=</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">PIECE_WIDTH</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">*</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">PIECE_HEIGHT</span><br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">return</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">false</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">unless</span> piece_board[piece_position].nil?<br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br /><br />  first_circle_spot <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> _piece_spot_to_circle_spot(first_piece_spot)<br />  _circle_positions(first_circle_spot, piece).each <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">do </span>|<span class="pl-smi" style="box-sizing: border-box;">spot</span>|<br />    <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">return</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">false</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">unless</span> board[spot].nil?<br />  <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span><br /><br />  <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">true</span><br /><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span></pre><br />When verifying that a piece fits on a board, we first perform a check to see if the piece position goes off the edge of the board horizontally. Then we check both the piece positions and the circle positions to make sure that they both fit on the board.<br /><br />When checking the piece positions, we verify that the piece does not go off the board vertically and that there are no other pieces that would be in the way of this piece before we place it.<br /><br />Finally, we check all the circle positions that this piece would fill on the board and verify that no previous pieces are filling these circle positions. If all of these checks pass then this piece can validly be placed on this board.<br /><h4></h4><h3></h3><h3></h3><h3><br /></h3><h3>Putting It All Together</h3><div><br />Now that we have our domain and our solver, we can put them together to solve our puzzle.</div><div><br /></div><div><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: consolas, &quot;liberation mono&quot;, menlo, courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; overflow: auto; padding: 16px; word-break: normal; word-wrap: normal;"><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">def</span> <span class="pl-en" style="box-sizing: border-box; color: #795da3;">main</span><br />  pieces <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> _init_pieces<br />  board <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">Board</span>.<span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">new</span>([<span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">0</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">7</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">14</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">21</span>, <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">28</span>])<br />  solution <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">=</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">Solver</span>.solve(board, pieces)<br />  puts solution<br /><span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">end</span></pre></div><br /><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: consolas, &quot;liberation mono&quot;, menlo, courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; overflow: auto; padding: 16px; word-break: normal; word-wrap: normal;">main <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">if</span> <span class="pl-c1" style="box-sizing: border-box; color: #0086b3;">__FILE__</span> <span class="pl-k" style="box-sizing: border-box; color: #a71d5d;">==</span> <span class="pl-smi" style="box-sizing: border-box;">$PROGRAM_NAME</span></pre><br />Main is the main jumping point into our program. We initialize all of our distinct pieces, set up a board passing in a list of constraints that represent the 5 circles we want to be blank at the end, invoke solve on our board and pieces, and then print the solution.<br /><h4></h4><h3></h3><h3></h3><h3><br /></h3><h3>The Results</h3><div><br /></div><div>Because this is a depth-first search solution, solution times will vary depending on where the solution is located in your search space and how you choose to traverse that space. Solving three puzzles with different constraints produced the following results:</div><div><br /></div><table><tbody><tr><th>Puzzle Constraints</th><th>Time to Solve</th><th>Total Pieces Placed</th></tr><tr><td>Board.new([0, 10, 20, 24, 28])</td><td>5m15.509s</td><td>4,461,278</td></tr><tr><td>Board.new([0, 7, 14, 21, 28])</td><td>2m49.996s</td><td>2,397,106</td></tr><tr><td>Board.new([25, 26, 27, 32, 33, 34]) (Unsolvable)</td><td>24 hours+</td><td>1,220,171,512</td></tr></tbody></table><div><br /></div><div><br />The puzzle with unsolvable constraints gives you an idea of size of the search space of this problem. I stopped the solver after 24 hours. Though it is difficult to adequately determine the total number possible placements of pieces due to the complexity of the constraints, my rough calculations indicate that to try all possible combinations of laying pieces on the board would take years given this solver.<br /><br />These results were derived on my laptop with a core i7 processor, running single-threaded (because this is Ruby).<br /><br />A lot of improvements could be made to the performance of this algorithm. This approach is fairly naive and leaves out a lot of optimizations for the sake of readability. For example, a faster algorithm would take advantage of constraints as soon as possible, so it would be more optimal to find the provided constraints and place pieces around them, failing faster than trying possibilities that do not take advantage of these constraints.<br /><br />Also, choosing a more performant language and one that can utilize native threads to parallelize the search for a solution would provide an additional speedup that we are not able to leverage with Ruby.<br /><br />Thanks for reading! Have any thoughts on solving this puzzle or solving any other puzzles using artificial intelligence? Leave a comment below.</div><div><br /></div>
